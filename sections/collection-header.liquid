{% comment %} {%- assign disable_sticky_header = false -%}

{%- if section.settings.enable -%}
  {%- if section.settings.collection_image_enable and collection.image -%}
    <div
      id="CollectionHeaderSection"
      data-section-id="{{ section.id }}"
      data-section-type="collection-header"
      {% if section.settings.parallax %}data-parallax="true"{% endif %}>

      <div class="collection-hero">

        {%- if section.settings.parallax -%}
          <parallax-image class="parallax-container">
            <div class="parallax-image" data-movement="15%" data-parallax-image data-angle="{{ section.settings.parallax_direction }}">
        {%- endif -%}

          {%- render 'image-element',
              img: collection.image,
              img_width: 2400,
              classes: 'collection-hero__image image-fit',
              preload: true,
              loading: 'eager',
          -%}

        {%- if section.settings.parallax -%}
            </div>
          </parallax-image>
        {%- endif -%}

        <div class="collection-hero__content">
          <div class="page-width">
            <header class="section-header section-header--hero">
              <div class="section-header__shadow">
                {%- render 'breadcrumbs' -%}
                <h1 class="section-header__title">
                  {{ collection.title }}
                </h1>
              </div>
            </header>
          </div>
        </div>

        
      </div>
    </div>
  {%- else -%}
    {%- assign disable_sticky_header = true -%}
    <div class="page-width page-content page-content--top">
      <header class="section-header section-header--flush">
        {%- render 'breadcrumbs' -%}
        <h1 class="section-header__title">
          {{ collection.title }}
        </h1>
      </header>
    </div>
  {%- endif -%}
{% else %}
  {%- assign disable_sticky_header = true -%}
{%- endif -%}

{%- if disable_sticky_header -%}
  {% comment %}
    Div to trigger theme.CollectionHeader JS
  {% endcomment %}
  <div
    id="CollectionHeaderSection"
    data-section-id="{{ section.id }}"
    data-section-type="collection-header">
  </div>
{%- endif -%} {% endcomment %}


{%- if section.settings.enable -%}
<div class="alh-collection_header">
  <div class="alh-collection_top" style="background-color: {% if collection.metafields.alh.background_color %} {{ collection.metafields.alh.background_color }} {% else %} #3FB8D0 {% endif %}">
    <div class="page-width alh-collection_top_container">
      {% if collection.metafields.alh.collection_logo %}
       <img src="{{ collection.metafields.alh.collection_logo | img_url: 'master' }}" alt="{{ collection.title }}">
       {% else %}
        <h1 class="alh-collection_title alh-collection_title-top">
          {{ collection.title }}
        </h1>
      {% endif %}

      {% assign main_collection = collection.metafields.alh.main_collection.value %}
      
      {% if main_collection %}
        <div class="alh-main_collection-container">
          <a href="{{ main_collection.alh_collection.value.url }}">
            <img src="{{ main_collection.collection_image | img_url: 'medium' }}" alt="{{ main_collection.collection_name }}">
          </a>
        </div>
      {% endif %}
    </div>
  </div>

  
  {% if collection.metafields.alh.sub_collections %}
    <div class="alh-collection_bottom">
      <div class="page-width">
        <div class="alh-collection_desc">
          <h1 class="alh-collection_title">
            {{ collection.title }}
          </h1>
          {{ collection.metafields.alh.short_description | metafield_tag }}
        </div>

        
        <div class="alh-sub_collections">
          <div class="swiper">
            <div class="swiper-wrapper">
              {% assign sub_collections = collection.metafields.alh.sub_collections.value %}

              {% for handle in sub_collections %}
                {% assign sub_collection = handle %}
                {% if sub_collection and sub_collection.products_count > 0 %}
                  {% assign first_product = sub_collection.products.first %}
                  <div class="swiper-slide sub-collection-item">
                    <a href="{{ sub_collection.url }}">
                      {% if first_product.featured_image %}
                        <div class="sub-coll_img">
                          <img src="{{ first_product.featured_image | img_url: 'medium' }}" alt="{{ first_product.title }}">
                        </div>
                      {% endif %}
                      <h3>{{ sub_collection.title }}</h3>
                    </a>
                  </div>
                {% endif %}
              {% endfor %}
            </div>
            
            <!-- Swiper navigation (optional) -->
            <div class="swiper-button-prev alh-swiper-button-prev">
              <img src="{{ 'left-arrow.svg' | asset_url }}" alt="Email icon" height="52" width="52">
            </div>
            <div class="swiper-button-next alh-swiper-button-next">
              <img src="{{ 'right-arrow.svg' | asset_url }}" alt="Email icon" height="52" width="52">
            </div>
          </div>
        </div>
        
      </div>
    </div>
  {% endif %}

  {% if collection.metafields.alh.sub_collection_type %}
    <div class="alh-collection_bottom">
      <div class="page-width alh-collection_type_container">
        <div class="alh-collection_desc">
          <h1 class="alh-collection_title">
            {{ collection.title }}
          </h1>
          {{ collection.metafields.alh.short_description | metafield_tag }}
        </div>
        {% assign sub_collections_type = collection.metafields.alh.sub_collection_type.value %}

        <div class="alh-sub-collection_type">
          {% for typeHandle in sub_collections_type %}
            <a href="{{ collection.url }}?filter.p.product_type={{ typeHandle.type }}">
              <div class="sub-coll_img">
                <img src="{{ typeHandle.image | img_url: 'medium' }}" alt="{{ typeHandle.type }}">
              </div>
              <h3>{{ typeHandle.title }}</h3>
            </a>
          {% endfor %}
        </div>

        
      </div>
    </div>
  {% endif %}

</div>
{%- endif -%}


<script>
  document.addEventListener("DOMContentLoaded", function () {
    new Swiper('.alh-sub_collections .swiper', {
      slidesPerView: 1.5,
      spaceBetween: 20,
      navigation: {
        nextEl: '.alh-swiper-button-next',
        prevEl: '.alh-swiper-button-prev'
      },
      breakpoints: {
        768: {
          slidesPerView: 2.5
        },
        1024: {
          slidesPerView: 3.5
        }
      }
    });

    const slides = document.querySelectorAll('.alh-collection_type_container .sub-coll_img');
    const slidesDesk = document.querySelectorAll('.alh-sub_collections .sub-coll_img');
    const alhSlidesHeight = document.querySelectorAll('.swiper-slide.sub-collection-item');

    function equalizeTestimonialHeights(slides) {
      
      let maxHeight = 0;
      // Reset height
      slides.forEach(slide => {
        slide.style.height = 'auto';
      });
      // Calculate max height
      slides.forEach(slide => {
        const height = slide.offsetHeight;
        if (height > maxHeight) maxHeight = height;
      });
      // Apply max height to all
      slides.forEach(slide => {
        slide.style.height = maxHeight + 'px';
      });
    }
    {% comment %} window.addEventListener('load', equalizeTestimonialHeights(slides));
    window.addEventListener('resize', equalizeTestimonialHeights(slides));
    setTimeout(equalizeTestimonialHeights(slides), 500);

    {% endcomment %}

    {% comment %} window.addEventListener('load', equalizeTestimonialHeights(alhSlidesHeight));
    window.addEventListener('resize', equalizeTestimonialHeights(alhSlidesHeight));
    setTimeout(equalizeTestimonialHeights(alhSlidesHeight), 500);  {% endcomment %}



  });
</script>





{% schema %}
{
  "name": "t:sections.collection-header.name",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable",
      "label": "t:sections.collection-header.settings.enable.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "collection_image_enable",
      "label": "t:sections.collection-header.settings.collection_image_enable.label",
      "default": true
    }
  ],
  "disabled_on": {
    "groups": ["footer", "header", "custom.popups"]
  }
}
{% endschema %}
